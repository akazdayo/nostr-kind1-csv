import"../chunks/DsnmJJEf.js";import{aX as An,t as Bn,e as Sn,a6 as Tn,q as In,aY as ke,aZ as _n,$ as $n,R as Oe,a1 as Z,S as Pe,X as D,Q as Be,a0 as kn,aL as F,aU as Se,a3 as X,a2 as G,a_ as kt,am as Ln,aW as Un,P as Hn}from"../chunks/D9CaLhLl.js";import{d as On,s as Lt}from"../chunks/CKp4CoLW.js";import{i as Re}from"../chunks/IPFvOrhc.js";import{r as Nn,a as Cn}from"../chunks/Z0-f0AGn.js";function Ut(e,t,n=t){var r=new WeakSet;An(e,"input",async s=>{var o=s?e.defaultValue:e.value;if(o=Qe(e)?Xe(o):o,n(o),ke!==null&&r.add(ke),await Bn(),o!==(o=t())){var i=e.selectionStart,c=e.selectionEnd,a=e.value.length;if(e.value=o??"",c!==null){var l=e.value.length;i===c&&c===a&&l>a?(e.selectionStart=l,e.selectionEnd=l):(e.selectionStart=i,e.selectionEnd=Math.min(c,l))}}}),(In&&e.defaultValue!==e.value||Sn(t)==null&&e.value)&&(n(Qe(e)?Xe(e.value):e.value),ke!==null&&r.add(ke)),Tn(()=>{var s=t();if(e===document.activeElement){var o=_n??ke;if(r.has(o))return}Qe(e)&&s===Xe(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Qe(e){var t=e.type;return t==="number"||t==="range"}function Xe(e){return e===""?null:+e}function Ht(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Dt(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Pn(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ht(e.outputLen),Ht(e.blockLen)}function Ve(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Rn(e,t){Dt(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Je=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ft=e=>e instanceof Uint8Array,et=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ie=(e,t)=>e<<32-t|e>>>t,qn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!qn)throw new Error("Non little-endian hardware is not supported");function Vn(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function yt(e){if(typeof e=="string"&&(e=Vn(e)),!Ft(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Mn(...e){const t=new Uint8Array(e.reduce((r,s)=>r+s.length,0));let n=0;return e.forEach(r=>{if(!Ft(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Zt=class{clone(){return this._cloneInto()}};function Wn(e){const t=r=>e().update(yt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Gt(e=32){if(Je&&typeof Je.getRandomValues=="function")return Je.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function zn(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const s=BigInt(32),o=BigInt(4294967295),i=Number(n>>s&o),c=Number(n&o),a=r?4:0,l=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+l,c,r)}let jn=class extends Zt{constructor(t,n,r,s){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=et(this.buffer)}update(t){Ve(this);const{view:n,buffer:r,blockLen:s}=this;t=yt(t);const o=t.length;for(let i=0;i<o;){const c=Math.min(s-this.pos,o-i);if(c===s){const a=et(t);for(;s<=o-i;i+=s)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ve(this),Rn(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>s-i&&(this.process(r,0),i=0);for(let u=i;u<s;u++)n[u]=0;zn(r,s-8,BigInt(this.length*8),o),this.process(r,0);const c=et(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)c.setUint32(4*u,f[u],o)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:i,pos:c}=this;return t.length=s,t.pos=c,t.finished=o,t.destroyed=i,s%n&&t.buffer.set(r),t}};const Kn=(e,t,n)=>e&t^~e&n,Dn=(e,t,n)=>e&t^e&n^t&n,Fn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),he=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),de=new Uint32Array(64);let Zn=class extends jn{constructor(){super(64,32,8,!1),this.A=he[0]|0,this.B=he[1]|0,this.C=he[2]|0,this.D=he[3]|0,this.E=he[4]|0,this.F=he[5]|0,this.G=he[6]|0,this.H=he[7]|0}get(){const{A:t,B:n,C:r,D:s,E:o,F:i,G:c,H:a}=this;return[t,n,r,s,o,i,c,a]}set(t,n,r,s,o,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let u=0;u<16;u++,n+=4)de[u]=t.getUint32(n,!1);for(let u=16;u<64;u++){const w=de[u-15],p=de[u-2],y=ie(w,7)^ie(w,18)^w>>>3,h=ie(p,17)^ie(p,19)^p>>>10;de[u]=h+de[u-7]+y+de[u-16]|0}let{A:r,B:s,C:o,D:i,E:c,F:a,G:l,H:f}=this;for(let u=0;u<64;u++){const w=ie(c,6)^ie(c,11)^ie(c,25),p=f+w+Kn(c,a,l)+Fn[u]+de[u]|0,h=(ie(r,2)^ie(r,13)^ie(r,22))+Dn(r,s,o)|0;f=l,l=a,a=c,c=i+p|0,i=o,o=s,s=r,r=p+h|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,s,o,i,c,a,l,f)}roundClean(){de.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const at=Wn(()=>new Zn);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Yt=BigInt(0),Ke=BigInt(1),Gn=BigInt(2),De=e=>e instanceof Uint8Array,Yn=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ie(e){if(!De(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Yn[e[n]];return t}function Qt(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function mt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function _e(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const s=r*2,o=e.slice(s,s+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Y(e){return mt(Ie(e))}function xt(e){if(!De(e))throw new Error("Uint8Array expected");return mt(Ie(Uint8Array.from(e).reverse()))}function pe(e,t){return _e(e.toString(16).padStart(t*2,"0"))}function Et(e,t){return pe(e,t).reverse()}function Qn(e){return _e(Qt(e))}function z(e,t,n){let r;if(typeof t=="string")try{r=_e(t)}catch(o){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${o}`)}else if(De(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const s=r.length;if(typeof n=="number"&&s!==n)throw new Error(`${e} expected ${n} bytes, got ${s}`);return r}function Ee(...e){const t=new Uint8Array(e.reduce((r,s)=>r+s.length,0));let n=0;return e.forEach(r=>{if(!De(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Xn(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Jn(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function er(e){let t;for(t=0;e>Yt;e>>=Ke,t+=1);return t}function tr(e,t){return e>>BigInt(t)&Ke}const nr=(e,t,n)=>e|(n?Ke:Yt)<<BigInt(t),vt=e=>(Gn<<BigInt(e-1))-Ke,tt=e=>new Uint8Array(e),Ot=e=>Uint8Array.from(e);function Xt(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=tt(e),s=tt(e),o=0;const i=()=>{r.fill(1),s.fill(0),o=0},c=(...u)=>n(s,r,...u),a=(u=tt())=>{s=c(Ot([0]),u),r=c(),u.length!==0&&(s=c(Ot([1]),u),r=c())},l=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const w=[];for(;u<t;){r=c();const p=r.slice();w.push(p),u+=r.length}return Ee(...w)};return(u,w)=>{i(),a(u);let p;for(;!(p=w(l()));)a();return i(),p}}const rr={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Ne(e,t,n={}){const r=(s,o,i)=>{const c=rr[o];if(typeof c!="function")throw new Error(`Invalid validator "${o}", expected function`);const a=e[s];if(!(i&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(s)}=${a} (${typeof a}), expected ${o}`)};for(const[s,o]of Object.entries(t))r(s,o,!1);for(const[s,o]of Object.entries(n))r(s,o,!0);return e}const sr=Object.freeze(Object.defineProperty({__proto__:null,bitGet:tr,bitLen:er,bitMask:vt,bitSet:nr,bytesToHex:Ie,bytesToNumberBE:Y,bytesToNumberLE:xt,concatBytes:Ee,createHmacDrbg:Xt,ensureBytes:z,equalBytes:Xn,hexToBytes:_e,hexToNumber:mt,numberToBytesBE:pe,numberToBytesLE:Et,numberToHexUnpadded:Qt,numberToVarBytesBE:Qn,utf8ToBytes:Jn,validateObject:Ne},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const q=BigInt(0),P=BigInt(1),me=BigInt(2),or=BigInt(3),lt=BigInt(4),Nt=BigInt(5),Ct=BigInt(8);BigInt(9);BigInt(16);function W(e,t){const n=e%t;return n>=q?n:t+n}function ir(e,t,n){if(n<=q||t<q)throw new Error("Expected power/modulo > 0");if(n===P)return q;let r=P;for(;t>q;)t&P&&(r=r*e%n),e=e*e%n,t>>=P;return r}function J(e,t,n){let r=e;for(;t-- >q;)r*=r,r%=n;return r}function ut(e,t){if(e===q||t<=q)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=W(e,t),r=t,s=q,o=P;for(;n!==q;){const c=r/n,a=r%n,l=s-o*c;r=n,n=a,s=o,o=l}if(r!==P)throw new Error("invert: does not exist");return W(s,t)}function cr(e){const t=(e-P)/me;let n,r,s;for(n=e-P,r=0;n%me===q;n/=me,r++);for(s=me;s<e&&ir(s,t,e)!==e-P;s++);if(r===1){const i=(e+P)/lt;return function(a,l){const f=a.pow(l,i);if(!a.eql(a.sqr(f),l))throw new Error("Cannot find square root");return f}}const o=(n+P)/me;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let l=r,f=c.pow(c.mul(c.ONE,s),n),u=c.pow(a,o),w=c.pow(a,n);for(;!c.eql(w,c.ONE);){if(c.eql(w,c.ZERO))return c.ZERO;let p=1;for(let h=c.sqr(w);p<l&&!c.eql(h,c.ONE);p++)h=c.sqr(h);const y=c.pow(f,P<<BigInt(l-p-1));f=c.sqr(y),u=c.mul(u,y),w=c.mul(w,f),l=p}return u}}function ar(e){if(e%lt===or){const t=(e+P)/lt;return function(r,s){const o=r.pow(s,t);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(e%Ct===Nt){const t=(e-Nt)/Ct;return function(r,s){const o=r.mul(s,me),i=r.pow(o,t),c=r.mul(s,i),a=r.mul(r.mul(c,me),i),l=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return cr(e)}const lr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ur(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=lr.reduce((r,s)=>(r[s]="function",r),t);return Ne(e,n)}function fr(e,t,n){if(n<q)throw new Error("Expected power > 0");if(n===q)return e.ONE;if(n===P)return t;let r=e.ONE,s=t;for(;n>q;)n&P&&(r=e.mul(r,s)),s=e.sqr(s),n>>=P;return r}function hr(e,t){const n=new Array(t.length),r=t.reduce((o,i,c)=>e.is0(i)?o:(n[c]=o,e.mul(o,i)),e.ONE),s=e.inv(r);return t.reduceRight((o,i,c)=>e.is0(i)?o:(n[c]=e.mul(o,n[c]),e.mul(o,i)),s),n}function Jt(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function dr(e,t,n=!1,r={}){if(e<=q)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:s,nByteLength:o}=Jt(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=ar(e),c=Object.freeze({ORDER:e,BITS:s,BYTES:o,MASK:vt(s),ZERO:q,ONE:P,create:a=>W(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return q<=a&&a<e},is0:a=>a===q,isOdd:a=>(a&P)===P,neg:a=>W(-a,e),eql:(a,l)=>a===l,sqr:a=>W(a*a,e),add:(a,l)=>W(a+l,e),sub:(a,l)=>W(a-l,e),mul:(a,l)=>W(a*l,e),pow:(a,l)=>fr(c,a,l),div:(a,l)=>W(a*ut(l,e),e),sqrN:a=>a*a,addN:(a,l)=>a+l,subN:(a,l)=>a-l,mulN:(a,l)=>a*l,inv:a=>ut(a,e),sqrt:r.sqrt||(a=>i(c,a)),invertBatch:a=>hr(c,a),cmov:(a,l,f)=>f?l:a,toBytes:a=>n?Et(a,o):pe(a,o),fromBytes:a=>{if(a.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${a.length}`);return n?xt(a):Y(a)}});return Object.freeze(c)}function en(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function tn(e){const t=en(e);return t+Math.ceil(t/2)}function wr(e,t,n=!1){const r=e.length,s=en(t),o=tn(t);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const i=n?Y(e):xt(e),c=W(i,t-P)+P;return n?Et(c,s):pe(c,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gr=BigInt(0),nt=BigInt(1);function pr(e,t){const n=(s,o)=>{const i=o.negate();return s?i:o},r=s=>{const o=Math.ceil(t/s)+1,i=2**(s-1);return{windows:o,windowSize:i}};return{constTimeNegate:n,unsafeLadder(s,o){let i=e.ZERO,c=s;for(;o>gr;)o&nt&&(i=i.add(c)),c=c.double(),o>>=nt;return i},precomputeWindow(s,o){const{windows:i,windowSize:c}=r(o),a=[];let l=s,f=l;for(let u=0;u<i;u++){f=l,a.push(f);for(let w=1;w<c;w++)f=f.add(l),a.push(f);l=f.double()}return a},wNAF(s,o,i){const{windows:c,windowSize:a}=r(s);let l=e.ZERO,f=e.BASE;const u=BigInt(2**s-1),w=2**s,p=BigInt(s);for(let y=0;y<c;y++){const h=y*a;let g=Number(i&u);i>>=p,g>a&&(g-=w,i+=nt);const b=h,v=h+Math.abs(g)-1,B=y%2!==0,$=g<0;g===0?f=f.add(n(B,o[b])):l=l.add(n($,o[v]))}return{p:l,f}},wNAFCached(s,o,i,c){const a=s._WINDOW_SIZE||1;let l=o.get(s);return l||(l=this.precomputeWindow(s,a),a!==1&&o.set(s,c(l))),this.wNAF(a,l,i)}}}function nn(e){return ur(e.Fp),Ne(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Jt(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function br(e){const t=nn(e);Ne(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:s}=t;if(n){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:yr,hexToBytes:mr}=sr,xe={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=xe;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:yr(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=xe,n=typeof e=="string"?mr(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:s,l:o}=xe._parseInt(n.subarray(2)),{d:i,l:c}=xe._parseInt(o);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:i}},hexFromSig(e){const t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},r=t(n(e.s)),s=t(n(e.r)),o=r.length/2,i=s.length/2,c=n(o),a=n(i);return`30${n(i+o+4)}02${a}${s}02${c}${r}`}},ae=BigInt(0),ee=BigInt(1);BigInt(2);const Pt=BigInt(3);BigInt(4);function xr(e){const t=br(e),{Fp:n}=t,r=t.toBytes||((y,h,g)=>{const b=h.toAffine();return Ee(Uint8Array.from([4]),n.toBytes(b.x),n.toBytes(b.y))}),s=t.fromBytes||(y=>{const h=y.subarray(1),g=n.fromBytes(h.subarray(0,n.BYTES)),b=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:g,y:b}});function o(y){const{a:h,b:g}=t,b=n.sqr(y),v=n.mul(b,y);return n.add(n.add(v,n.mul(y,h)),g)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function i(y){return typeof y=="bigint"&&ae<y&&y<t.n}function c(y){if(!i(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(y){const{allowedPrivateKeyLengths:h,nByteLength:g,wrapPrivateKey:b,n:v}=t;if(h&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=Ie(y)),typeof y!="string"||!h.includes(y.length))throw new Error("Invalid key");y=y.padStart(g*2,"0")}let B;try{B=typeof y=="bigint"?y:Y(z("private key",y,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof y}`)}return b&&(B=W(B,v)),c(B),B}const l=new Map;function f(y){if(!(y instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(h,g,b){if(this.px=h,this.py=g,this.pz=b,h==null||!n.isValid(h))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(b==null||!n.isValid(b))throw new Error("z required")}static fromAffine(h){const{x:g,y:b}=h||{};if(!h||!n.isValid(g)||!n.isValid(b))throw new Error("invalid affine point");if(h instanceof u)throw new Error("projective point not allowed");const v=B=>n.eql(B,n.ZERO);return v(g)&&v(b)?u.ZERO:new u(g,b,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){const g=n.invertBatch(h.map(b=>b.pz));return h.map((b,v)=>b.toAffine(g[v])).map(u.fromAffine)}static fromHex(h){const g=u.fromAffine(s(z("pointHex",h)));return g.assertValidity(),g}static fromPrivateKey(h){return u.BASE.multiply(a(h))}_setWindowSize(h){this._WINDOW_SIZE=h,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:h,y:g}=this.toAffine();if(!n.isValid(h)||!n.isValid(g))throw new Error("bad point: x or y not FE");const b=n.sqr(g),v=o(h);if(!n.eql(b,v))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){f(h);const{px:g,py:b,pz:v}=this,{px:B,py:$,pz:_}=h,E=n.eql(n.mul(g,_),n.mul(B,v)),S=n.eql(n.mul(b,_),n.mul($,v));return E&&S}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:h,b:g}=t,b=n.mul(g,Pt),{px:v,py:B,pz:$}=this;let _=n.ZERO,E=n.ZERO,S=n.ZERO,T=n.mul(v,v),j=n.mul(B,B),U=n.mul($,$),k=n.mul(v,B);return k=n.add(k,k),S=n.mul(v,$),S=n.add(S,S),_=n.mul(h,S),E=n.mul(b,U),E=n.add(_,E),_=n.sub(j,E),E=n.add(j,E),E=n.mul(_,E),_=n.mul(k,_),S=n.mul(b,S),U=n.mul(h,U),k=n.sub(T,U),k=n.mul(h,k),k=n.add(k,S),S=n.add(T,T),T=n.add(S,T),T=n.add(T,U),T=n.mul(T,k),E=n.add(E,T),U=n.mul(B,$),U=n.add(U,U),T=n.mul(U,k),_=n.sub(_,T),S=n.mul(U,j),S=n.add(S,S),S=n.add(S,S),new u(_,E,S)}add(h){f(h);const{px:g,py:b,pz:v}=this,{px:B,py:$,pz:_}=h;let E=n.ZERO,S=n.ZERO,T=n.ZERO;const j=t.a,U=n.mul(t.b,Pt);let k=n.mul(g,B),V=n.mul(b,$),R=n.mul(v,_),se=n.add(g,b),d=n.add(B,$);se=n.mul(se,d),d=n.add(k,V),se=n.sub(se,d),d=n.add(g,v);let x=n.add(B,_);return d=n.mul(d,x),x=n.add(k,R),d=n.sub(d,x),x=n.add(b,v),E=n.add($,_),x=n.mul(x,E),E=n.add(V,R),x=n.sub(x,E),T=n.mul(j,d),E=n.mul(U,R),T=n.add(E,T),E=n.sub(V,T),T=n.add(V,T),S=n.mul(E,T),V=n.add(k,k),V=n.add(V,k),R=n.mul(j,R),d=n.mul(U,d),V=n.add(V,R),R=n.sub(k,R),R=n.mul(j,R),d=n.add(d,R),k=n.mul(V,d),S=n.add(S,k),k=n.mul(x,d),E=n.mul(se,E),E=n.sub(E,k),k=n.mul(se,V),T=n.mul(x,T),T=n.add(T,k),new u(E,S,T)}subtract(h){return this.add(h.negate())}is0(){return this.equals(u.ZERO)}wNAF(h){return p.wNAFCached(this,l,h,g=>{const b=n.invertBatch(g.map(v=>v.pz));return g.map((v,B)=>v.toAffine(b[B])).map(u.fromAffine)})}multiplyUnsafe(h){const g=u.ZERO;if(h===ae)return g;if(c(h),h===ee)return this;const{endo:b}=t;if(!b)return p.unsafeLadder(this,h);let{k1neg:v,k1:B,k2neg:$,k2:_}=b.splitScalar(h),E=g,S=g,T=this;for(;B>ae||_>ae;)B&ee&&(E=E.add(T)),_&ee&&(S=S.add(T)),T=T.double(),B>>=ee,_>>=ee;return v&&(E=E.negate()),$&&(S=S.negate()),S=new u(n.mul(S.px,b.beta),S.py,S.pz),E.add(S)}multiply(h){c(h);let g=h,b,v;const{endo:B}=t;if(B){const{k1neg:$,k1:_,k2neg:E,k2:S}=B.splitScalar(g);let{p:T,f:j}=this.wNAF(_),{p:U,f:k}=this.wNAF(S);T=p.constTimeNegate($,T),U=p.constTimeNegate(E,U),U=new u(n.mul(U.px,B.beta),U.py,U.pz),b=T.add(U),v=j.add(k)}else{const{p:$,f:_}=this.wNAF(g);b=$,v=_}return u.normalizeZ([b,v])[0]}multiplyAndAddUnsafe(h,g,b){const v=u.BASE,B=(_,E)=>E===ae||E===ee||!_.equals(v)?_.multiplyUnsafe(E):_.multiply(E),$=B(this,g).add(B(h,b));return $.is0()?void 0:$}toAffine(h){const{px:g,py:b,pz:v}=this,B=this.is0();h==null&&(h=B?n.ONE:n.inv(v));const $=n.mul(g,h),_=n.mul(b,h),E=n.mul(v,h);if(B)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:$,y:_}}isTorsionFree(){const{h,isTorsionFree:g}=t;if(h===ee)return!0;if(g)return g(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h,clearCofactor:g}=t;return h===ee?this:g?g(u,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return this.assertValidity(),r(u,this,h)}toHex(h=!0){return Ie(this.toRawBytes(h))}}u.BASE=new u(t.Gx,t.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const w=t.nBitLength,p=pr(u,t.endo?Math.ceil(w/2):w);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:o,isWithinCurveOrder:i}}function Er(e){const t=nn(e);return Ne(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function vr(e){const t=Er(e),{Fp:n,n:r}=t,s=n.BYTES+1,o=2*n.BYTES+1;function i(d){return ae<d&&d<n.ORDER}function c(d){return W(d,r)}function a(d){return ut(d,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:u,isWithinCurveOrder:w}=xr({...t,toBytes(d,x,I){const H=x.toAffine(),m=n.toBytes(H.x),A=Ee;return I?A(Uint8Array.from([x.hasEvenY()?2:3]),m):A(Uint8Array.from([4]),m,n.toBytes(H.y))},fromBytes(d){const x=d.length,I=d[0],H=d.subarray(1);if(x===s&&(I===2||I===3)){const m=Y(H);if(!i(m))throw new Error("Point is not on curve");const A=u(m);let O=n.sqrt(A);const L=(O&ee)===ee;return(I&1)===1!==L&&(O=n.neg(O)),{x:m,y:O}}else if(x===o&&I===4){const m=n.fromBytes(H.subarray(0,n.BYTES)),A=n.fromBytes(H.subarray(n.BYTES,2*n.BYTES));return{x:m,y:A}}else throw new Error(`Point of length ${x} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}}),p=d=>Ie(pe(d,t.nByteLength));function y(d){const x=r>>ee;return d>x}function h(d){return y(d)?c(-d):d}const g=(d,x,I)=>Y(d.slice(x,I));class b{constructor(x,I,H){this.r=x,this.s=I,this.recovery=H,this.assertValidity()}static fromCompact(x){const I=t.nByteLength;return x=z("compactSignature",x,I*2),new b(g(x,0,I),g(x,I,2*I))}static fromDER(x){const{r:I,s:H}=xe.toSig(z("DER",x));return new b(I,H)}assertValidity(){if(!w(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!w(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(x){return new b(this.r,this.s,x)}recoverPublicKey(x){const{r:I,s:H,recovery:m}=this,A=S(z("msgHash",x));if(m==null||![0,1,2,3].includes(m))throw new Error("recovery id invalid");const O=m===2||m===3?I+t.n:I;if(O>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const L=(m&1)===0?"02":"03",M=l.fromHex(L+p(O)),N=a(O),te=c(-A*N),K=c(H*N),C=l.BASE.multiplyAndAddUnsafe(M,te,K);if(!C)throw new Error("point at infinify");return C.assertValidity(),C}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return _e(this.toDERHex())}toDERHex(){return xe.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return _e(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const v={isValidPrivateKey(d){try{return f(d),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const d=tn(t.n);return wr(t.randomBytes(d),t.n)},precompute(d=8,x=l.BASE){return x._setWindowSize(d),x.multiply(BigInt(3)),x}};function B(d,x=!0){return l.fromPrivateKey(d).toRawBytes(x)}function $(d){const x=d instanceof Uint8Array,I=typeof d=="string",H=(x||I)&&d.length;return x?H===s||H===o:I?H===2*s||H===2*o:d instanceof l}function _(d,x,I=!0){if($(d))throw new Error("first arg must be private key");if(!$(x))throw new Error("second arg must be public key");return l.fromHex(x).multiply(f(d)).toRawBytes(I)}const E=t.bits2int||function(d){const x=Y(d),I=d.length*8-t.nBitLength;return I>0?x>>BigInt(I):x},S=t.bits2int_modN||function(d){return c(E(d))},T=vt(t.nBitLength);function j(d){if(typeof d!="bigint")throw new Error("bigint expected");if(!(ae<=d&&d<T))throw new Error(`bigint expected < 2^${t.nBitLength}`);return pe(d,t.nByteLength)}function U(d,x,I=k){if(["recovered","canonical"].some(Q=>Q in I))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:m}=t;let{lowS:A,prehash:O,extraEntropy:L}=I;A==null&&(A=!0),d=z("msgHash",d),O&&(d=z("prehashed msgHash",H(d)));const M=S(d),N=f(x),te=[j(N),j(M)];if(L!=null){const Q=L===!0?m(n.BYTES):L;te.push(z("extraEntropy",Q))}const K=Ee(...te),C=M;function ne(Q){const ve=E(Q);if(!w(ve))return;const It=a(ve),oe=l.BASE.multiply(ve).toAffine(),Ae=c(oe.x);if(Ae===ae)return;const Ce=c(It*c(C+Ae*N));if(Ce===ae)return;let _t=(oe.x===Ae?0:2)|Number(oe.y&ee),$t=Ce;return A&&y(Ce)&&($t=h(Ce),_t^=1),new b(Ae,$t,_t)}return{seed:K,k2sig:ne}}const k={lowS:t.lowS,prehash:!1},V={lowS:t.lowS,prehash:!1};function R(d,x,I=k){const{seed:H,k2sig:m}=U(d,x,I),A=t;return Xt(A.hash.outputLen,A.nByteLength,A.hmac)(H,m)}l.BASE._setWindowSize(8);function se(d,x,I,H=V){const m=d;if(x=z("msgHash",x),I=z("publicKey",I),"strict"in H)throw new Error("options.strict was renamed to lowS");const{lowS:A,prehash:O}=H;let L,M;try{if(typeof m=="string"||m instanceof Uint8Array)try{L=b.fromDER(m)}catch(oe){if(!(oe instanceof xe.Err))throw oe;L=b.fromCompact(m)}else if(typeof m=="object"&&typeof m.r=="bigint"&&typeof m.s=="bigint"){const{r:oe,s:Ae}=m;L=new b(oe,Ae)}else throw new Error("PARSE");M=l.fromHex(I)}catch(oe){if(oe.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(A&&L.hasHighS())return!1;O&&(x=t.hash(x));const{r:N,s:te}=L,K=S(x),C=a(te),ne=c(K*C),Q=c(N*C),ve=l.BASE.multiplyAndAddUnsafe(M,ne,Q)?.toAffine();return ve?c(ve.x)===N:!1}return{CURVE:t,getPublicKey:B,getSharedSecret:_,sign:R,verify:se,ProjectivePoint:l,Signature:b,utils:v}}class rn extends Zt{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Pn(t);const r=yt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?t.create().update(r).digest():r);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=t.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(t){return Ve(this),this.iHash.update(t),this}digestInto(t){Ve(this),Dt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:s,destroyed:o,blockLen:i,outputLen:c}=this;return t=t,t.finished=s,t.destroyed=o,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const sn=(e,t,n)=>new rn(e,t).update(n).digest();sn.create=(e,t)=>new rn(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ar(e){return{hash:e,hmac:(t,...n)=>sn(e,t,Mn(...n)),randomBytes:Gt}}function Br(e,t){const n=r=>vr({...e,...Ar(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fe=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Me=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),on=BigInt(1),We=BigInt(2),Rt=(e,t)=>(e+t/We)/t;function cn(e){const t=Fe,n=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),l=e*e*e%t,f=l*l*e%t,u=J(f,n,t)*f%t,w=J(u,n,t)*f%t,p=J(w,We,t)*l%t,y=J(p,s,t)*p%t,h=J(y,o,t)*y%t,g=J(h,c,t)*h%t,b=J(g,a,t)*g%t,v=J(b,c,t)*h%t,B=J(v,n,t)*f%t,$=J(B,i,t)*y%t,_=J($,r,t)*l%t,E=J(_,We,t);if(!ft.eql(ft.sqr(E),e))throw new Error("Cannot find square root");return E}const ft=dr(Fe,void 0,void 0,{sqrt:cn}),At=Br({a:BigInt(0),b:BigInt(7),Fp:ft,n:Me,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Me,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-on*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,i=BigInt("0x100000000000000000000000000000000"),c=Rt(o*e,t),a=Rt(-r*e,t);let l=W(e-c*n-a*s,t),f=W(-c*r-a*o,t);const u=l>i,w=f>i;if(u&&(l=t-l),w&&(f=t-f),l>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:l,k2neg:w,k2:f}}}},at),Ze=BigInt(0),an=e=>typeof e=="bigint"&&Ze<e&&e<Fe,Sr=e=>typeof e=="bigint"&&Ze<e&&e<Me,qt={};function ze(e,...t){let n=qt[e];if(n===void 0){const r=at(Uint8Array.from(e,s=>s.charCodeAt(0)));n=Ee(r,r),qt[e]=n}return at(Ee(n,...t))}const Bt=e=>e.toRawBytes(!0).slice(1),ht=e=>pe(e,32),rt=e=>W(e,Fe),He=e=>W(e,Me),St=At.ProjectivePoint,Tr=(e,t,n)=>St.BASE.multiplyAndAddUnsafe(e,t,n);function dt(e){let t=At.utils.normPrivateKeyToScalar(e),n=St.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:He(-t),bytes:Bt(n)}}function ln(e){if(!an(e))throw new Error("bad x: need 0 < x < p");const t=rt(e*e),n=rt(t*e+BigInt(7));let r=cn(n);r%We!==Ze&&(r=rt(-r));const s=new St(e,r,on);return s.assertValidity(),s}function un(...e){return He(Y(ze("BIP0340/challenge",...e)))}function Ir(e){return dt(e).bytes}function _r(e,t,n=Gt(32)){const r=z("message",e),{bytes:s,scalar:o}=dt(t),i=z("auxRand",n,32),c=ht(o^Y(ze("BIP0340/aux",i))),a=ze("BIP0340/nonce",c,s,r),l=He(Y(a));if(l===Ze)throw new Error("sign failed: k is zero");const{bytes:f,scalar:u}=dt(l),w=un(f,s,r),p=new Uint8Array(64);if(p.set(f,0),p.set(ht(He(u+w*o)),32),!fn(p,r,s))throw new Error("sign: Invalid signature produced");return p}function fn(e,t,n){const r=z("signature",e,64),s=z("message",t),o=z("publicKey",n,32);try{const i=ln(Y(o)),c=Y(r.subarray(0,32));if(!an(c))return!1;const a=Y(r.subarray(32,64));if(!Sr(a))return!1;const l=un(ht(c),Bt(i),s),f=Tr(i,a,He(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==c)}catch{return!1}}const Le={getPublicKey:Ir,sign:_r,verify:fn,utils:{randomPrivateKey:At.utils.randomPrivateKey,lift_x:ln,pointToBytes:Bt,numberToBytesBE:pe,bytesToNumberBE:Y,taggedHash:ze,mod:W}};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hn=e=>e instanceof Uint8Array,st=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ce=(e,t)=>e<<32-t|e>>>t,$r=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!$r)throw new Error("Non little-endian hardware is not supported");const kr=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function re(e){if(!hn(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=kr[e[n]];return t}function Lr(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function dn(e){if(typeof e=="string"&&(e=Lr(e)),!hn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}class Ur{clone(){return this._cloneInto()}}function wn(e){const t=r=>e().update(dn(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function wt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Hr(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function gn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Or(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");wt(e.outputLen),wt(e.blockLen)}function Nr(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Cr(e,t){gn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ot={number:wt,bool:Hr,bytes:gn,hash:Or,exists:Nr,output:Cr};function Pr(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const s=BigInt(32),o=BigInt(4294967295),i=Number(n>>s&o),c=Number(n&o),a=r?4:0,l=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+l,c,r)}class Rr extends Ur{constructor(t,n,r,s){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=st(this.buffer)}update(t){ot.exists(this);const{view:n,buffer:r,blockLen:s}=this;t=dn(t);const o=t.length;for(let i=0;i<o;){const c=Math.min(s-this.pos,o-i);if(c===s){const a=st(t);for(;s<=o-i;i+=s)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ot.exists(this),ot.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:o}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>s-i&&(this.process(r,0),i=0);for(let u=i;u<s;u++)n[u]=0;Pr(r,s-8,BigInt(this.length*8),o),this.process(r,0);const c=st(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)c.setUint32(4*u,f[u],o)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:o,destroyed:i,pos:c}=this;return t.length=s,t.pos=c,t.finished=o,t.destroyed=i,s%n&&t.buffer.set(r),t}}const qr=(e,t,n)=>e&t^~e&n,Vr=(e,t,n)=>e&t^e&n^t&n,Mr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),we=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ge=new Uint32Array(64);class pn extends Rr{constructor(){super(64,32,8,!1),this.A=we[0]|0,this.B=we[1]|0,this.C=we[2]|0,this.D=we[3]|0,this.E=we[4]|0,this.F=we[5]|0,this.G=we[6]|0,this.H=we[7]|0}get(){const{A:t,B:n,C:r,D:s,E:o,F:i,G:c,H:a}=this;return[t,n,r,s,o,i,c,a]}set(t,n,r,s,o,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let u=0;u<16;u++,n+=4)ge[u]=t.getUint32(n,!1);for(let u=16;u<64;u++){const w=ge[u-15],p=ge[u-2],y=ce(w,7)^ce(w,18)^w>>>3,h=ce(p,17)^ce(p,19)^p>>>10;ge[u]=h+ge[u-7]+y+ge[u-16]|0}let{A:r,B:s,C:o,D:i,E:c,F:a,G:l,H:f}=this;for(let u=0;u<64;u++){const w=ce(c,6)^ce(c,11)^ce(c,25),p=f+w+qr(c,a,l)+Mr[u]+ge[u]|0,h=(ce(r,2)^ce(r,13)^ce(r,22))+Vr(r,s,o)|0;f=l,l=a,a=c,c=i+p|0,i=o,o=s,s=r,r=p+h|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,s,o,i,c,a,l,f)}roundClean(){ge.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Wr extends pn{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const zr=wn(()=>new pn);wn(()=>new Wr);var ye=Symbol("verified"),jr=e=>e instanceof Object;function Kr(e){if(!jr(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}new TextDecoder("utf-8");var Dr=new TextEncoder;function Te(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}var Fr=class{value;next=null;prev=null;constructor(e){this.value=e}},Zr=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new Fr(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},Gr=class{generateSecretKey(){return Le.utils.randomPrivateKey()}getPublicKey(e){return re(Le.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=re(Le.getPublicKey(t)),n.id=it(n),n.sig=re(Le.sign(it(n),t)),n[ye]=!0,n}verifyEvent(e){if(typeof e[ye]=="boolean")return e[ye];const t=it(e);if(t!==e.id)return e[ye]=!1,!1;try{const n=Le.verify(e.sig,t,e.pubkey);return e[ye]=n,n}catch{return e[ye]=!1,!1}}};function Yr(e){if(!Kr(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function it(e){let t=zr(Dr.encode(Yr(e)));return re(t)}var Ge=new Gr;Ge.generateSecretKey;Ge.getPublicKey;Ge.finalizeEvent;var Qr=Ge.verifyEvent,Xr=22242;function Jr(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),s=e[`#${r}`];if(s&&!t.tags.find(([o,i])=>o===n.slice(1)&&s.indexOf(i)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function es(e,t){for(let n=0;n<e.length;n++)if(Jr(e[n],t))return!0;return!1}function ts(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,s=e.slice(r).indexOf('"')+r+1;return e.slice(s,s+64)}function ns(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,s=e.slice(r+1,80).indexOf('"');if(s===-1)return null;let o=r+1+s;return e.slice(r+1,o)}function rs(e,t){return{kind:Xr,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function ss(){return new Promise(e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var os=e=>(e[ye]=!0,!0),bn=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},yn=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=2e4;pingTimeout=2e4;openSubs=new Map;enablePing;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Zr;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=Te(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing}static async connect(e,t){const n=new yn(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){clearTimeout(this.connectionTimeoutHandle),t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,this.enablePing&&this.pingpong(),e()},this.ws.onerror=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket error"),this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored")},this.ws.onclose=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket closed"),this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async waitForPingPong(){return new Promise((e,t)=>{this.ws&&this.ws.on&&this.ws.on("pong",()=>e(!0))||t("ws can't listen for pong"),this.ws&&this.ws.ping&&this.ws.ping()})}async waitForDummyReq(){return new Promise((e,t)=>{const n=this.subscribe([{ids:["a".repeat(64)]}],{oneose:()=>{n.close(),e(!0)},eoseTimeout:this.pingTimeout+1e3})})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.on?this.waitForPingPong():this.waitForDummyReq(),new Promise(t=>setTimeout(()=>t(!1),this.pingTimeout))])?setTimeout(()=>this.pingpong(),this.pingFrequency):(this.closeAllSubscriptions("pingpong timed out"),this._connected=!1,this.onclose?.(),this.ws?.close()))}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await ss();this.queueRunning=!1}handleNext(){const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=ns(e);if(t){const n=this.openSubs.get(t);if(!n)return;const r=ts(e,"id"),s=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),s)return}try{let n=JSON.parse(e);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),s=n[2];this.verifyEvent(s)&&es(r.filters,s)&&r.onevent(s);return}case"COUNT":{const r=n[1],s=n[2],o=this.openCountRequests.get(r);o&&(o.resolve(s.count),this.openCountRequests.delete(r));return}case"EOSE":{const r=this.openSubs.get(n[1]);if(!r)return;r.receivedEose();return}case"OK":{const r=n[1],s=n[2],o=n[3],i=this.openEventPublishes.get(r);i&&(clearTimeout(i.timeout),s?i.resolve(o):i.reject(new Error(o)),this.openEventPublishes.delete(r));return}case"CLOSED":{const r=n[1],s=this.openSubs.get(r);if(!s)return;s.closed=!0,s.close(n[2]);return}case"NOTICE":this.onnotice(n[1]);return;case"AUTH":{this.challenge=n[1];return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new bn(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){const t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,r)=>{try{let s=await e(rs(this.url,t)),o=setTimeout(()=>{let i=this.openEventPublishes.get(s.id);i&&(i.reject(new Error("auth timed out")),this.openEventPublishes.delete(s.id))},this.publishTimeout);this.openEventPublishes.set(s.id,{resolve:n,reject:r,timeout:o}),this.send('["AUTH",'+JSON.stringify(s)+"]")}catch(s){console.warn("subscribe auth function failed:",s)}}),this.authPromise)}async publish(e){const t=new Promise((n,r)=>{const s=setTimeout(()=>{const o=this.openEventPublishes.get(e.id);o&&(o.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:r,timeout:s})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=t?.id||"count:"+this.serial,r=new Promise((s,o)=>{this.openCountRequests.set(n,{resolve:s,reject:o})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||(t.label?t.label+":":"sub:")+this.serial,r=new is(this,n,e,t);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},is=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(s=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,s)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(t){if(!(t instanceof bn))throw t}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(e)}},cs=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;trustedRelayURLs=new Set;_WebSocket;constructor(e){this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation,this.enablePing=e.enablePing}async ensureRelay(e,t){e=Te(e);let n=this.relays.get(e);return n||(n=new yn(e,{verifyEvent:this.trustedRelayURLs.has(e)?os:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing}),n.onclose=()=>{this.relays.delete(e)},t?.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(Te).forEach(t=>{this.relays.get(t)?.close(),this.relays.delete(t)})}subscribe(e,t,n){n.onauth=n.onauth||n.doauth;const r=[];for(let s=0;s<e.length;s++){const o=Te(e[s]);r.find(i=>i.url===o)||r.push({url:o,filter:t})}return this.subscribeMap(r,n)}subscribeMany(e,t,n){n.onauth=n.onauth||n.doauth;const r=[],s=[];for(let o=0;o<e.length;o++){const i=Te(e[o]);s.indexOf(i)===-1&&(s.push(i),r.push({url:i,filter:t}))}return this.subscribeMap(r,n)}subscribeMap(e,t){t.onauth=t.onauth||t.doauth;const n=new Map;for(const w of e){const{url:p,filter:y}=w;n.has(p)||n.set(p,[]),n.get(p).push(y)}const r=Array.from(n.entries()).map(([w,p])=>({url:w,filters:p}));this.trackRelays&&(t.receivedEvent=(w,p)=>{let y=this.seenOn.get(p);y||(y=new Set,this.seenOn.set(p,y)),y.add(w)});const s=new Set,o=[],i=[];let c=w=>{i[w]||(i[w]=!0,i.filter(p=>p).length===e.length&&(t.oneose?.(),c=()=>{}))};const a=[];let l=(w,p)=>{a[w]||(c(w),a[w]=p,a.filter(y=>y).length===e.length&&(t.onclose?.(a),l=()=>{}))};const f=w=>{if(t.alreadyHaveEvent?.(w))return!0;const p=s.has(w);return s.add(w),p},u=Promise.all(r.map(async({url:w,filters:p},y)=>{let h;try{h=await this.ensureRelay(w,{connectionTimeout:t.maxWait?Math.max(t.maxWait*.8,t.maxWait-1e3):void 0})}catch(b){l(y,b?.message||String(b));return}let g=h.subscribe(p,{...t,oneose:()=>c(y),onclose:b=>{b.startsWith("auth-required: ")&&t.onauth?h.auth(t.onauth).then(()=>{h.subscribe(p,{...t,oneose:()=>c(y),onclose:v=>{l(y,v)},alreadyHaveEvent:f,eoseTimeout:t.maxWait})}).catch(v=>{l(y,`auth was required and attempted, but failed with: ${v}`)}):l(y,b)},alreadyHaveEvent:f,eoseTimeout:t.maxWait});o.push(g)}));return{async close(w){await u,o.forEach(p=>{p.close(w)})}}}subscribeEose(e,t,n){n.onauth=n.onauth||n.doauth;const r=this.subscribe(e,t,{...n,oneose(){r.close("closed automatically on eose")}});return r}subscribeManyEose(e,t,n){n.onauth=n.onauth||n.doauth;const r=this.subscribeMany(e,t,{...n,oneose(){r.close("closed automatically on eose")}});return r}async querySync(e,t,n){return new Promise(async r=>{const s=[];this.subscribeEose(e,t,{...n,onevent(o){s.push(o)},onclose(o){r(s)}})})}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort((s,o)=>o.created_at-s.created_at),r[0]||null}publish(e,t,n){return e.map(Te).map(async(r,s,o)=>{if(o.indexOf(r)!==s)return Promise.reject("duplicate url");let i=await this.ensureRelay(r);return i.publish(t).catch(async c=>{if(c instanceof Error&&c.message.startsWith("auth-required: ")&&n?.onauth)return await i.auth(n.onauth),i.publish(t);throw c}).then(c=>{if(this.trackRelays){let a=this.seenOn.get(t.id);a||(a=new Set,this.seenOn.set(t.id,a)),a.add(i)}return c})})}listConnectionStatus(){const e=new Map;return this.relays.forEach((t,n)=>e.set(n,t.connected)),e}destroy(){this.relays.forEach(e=>e.close()),this.relays=new Map}},mn;try{mn=WebSocket}catch{}var as=class extends cs{constructor(e){super({verifyEvent:Qr,websocketImplementation:mn,...e})}};/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $e(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function le(...e){const t=(s,o)=>i=>s(o(i)),n=Array.from(e).reverse().reduce((s,o)=>s?t(s,o.encode):o.encode,void 0),r=e.reduce((s,o)=>s?t(s,o.decode):o.decode,void 0);return{encode:n,decode:r}}function ue(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if($e(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function fe(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Ye(e,t="="){if($e(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function xn(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Vt(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const s=[],o=Array.from(e);for(o.forEach(i=>{if($e(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let a=r;a<o.length;a++){const l=o[a],f=t*i+l;if(!Number.isSafeInteger(f)||t*i/t!==i||f-l!==t*i)throw new Error("convertRadix: carry overflow");if(i=f%n,o[a]=Math.floor(f/n),!Number.isSafeInteger(o[a])||o[a]*n+i!==f)throw new Error("convertRadix: carry overflow");if(c)o[a]?c=!1:r=a;else continue}if(s.push(i),c)break}for(let i=0;i<e.length-1&&e[i]===0;i++)s.push(0);return s.reverse()}const En=(e,t)=>t?En(t,e%t):e,je=(e,t)=>e+(t-En(e,t));function gt(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(je(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${je(t,n)}`);let s=0,o=0;const i=2**n-1,c=[];for(const a of e){if($e(a),a>=2**t)throw new Error(`convertRadix2: invalid data word=${a} from=${t}`);if(s=s<<t|a,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=n;o-=n)c.push((s>>o-n&i)>>>0);s&=2**o-1}if(s=s<<n-o&i,!r&&o>=t)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&o>0&&c.push(s>>>0),c}function ls(e){return $e(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Vt(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Vt(t,e,2**8))}}}function be(e,t=!1){if($e(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(je(8,e)>32||je(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return gt(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(gt(n,e,8,t))}}}function Mt(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const us=le(be(4),ue("0123456789ABCDEF"),fe("")),fs=le(be(5),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Ye(5),fe(""));le(be(5),ue("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Ye(5),fe(""));le(be(5),ue("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),fe(""),xn(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const hs=le(be(6),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Ye(6),fe("")),ds=le(be(6),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Ye(6),fe("")),Tt=e=>le(ls(58),ue(e),fe("")),pt=Tt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Tt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Tt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Wt=[0,2,3,5,6,7,9,10,11],ws={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=pt.encode(r).padStart(Wt[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),s=Wt.indexOf(r.length),o=pt.decode(r);for(let i=0;i<o.length-s;i++)if(o[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(t)}},bt=le(ue("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),fe("")),zt=[996825010,642813549,513874426,1027748829,705979059];function Ue(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<zt.length;r++)(t>>r&1)===1&&(n^=zt[r]);return n}function jt(e,t,n=1){const r=e.length;let s=1;for(let o=0;o<r;o++){const i=e.charCodeAt(o);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);s=Ue(s)^i>>5}s=Ue(s);for(let o=0;o<r;o++)s=Ue(s)^e.charCodeAt(o)&31;for(let o of t)s=Ue(s)^o;for(let o=0;o<6;o++)s=Ue(s);return s^=n,bt.encode(gt([s%2**30],30,5,!1))}function vn(e){const t=e==="bech32"?1:734539939,n=be(5),r=n.decode,s=n.encode,o=Mt(r);function i(f,u,w=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);const p=f.length+7+u.length;if(w!==!1&&p>w)throw new TypeError(`Length ${p} exceeds limit ${w}`);return f=f.toLowerCase(),`${f}1${bt.encode(u)}${jt(f,u,t)}`}function c(f,u=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||u!==!1&&f.length>u)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${u})`);const w=f.toLowerCase();if(f!==w&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=w;const p=f.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=f.slice(0,p),h=f.slice(p+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");const g=bt.decode(h).slice(0,-6),b=jt(y,g,t);if(!h.endsWith(b))throw new Error(`Invalid checksum in ${f}: expected "${b}"`);return{prefix:y,words:g}}const a=Mt(c);function l(f){const{prefix:u,words:w}=c(f,!1);return{prefix:u,words:w,bytes:r(w)}}return{encode:i,decode:c,decodeToBytes:l,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:o,toWords:s}}const Kt=vn("bech32");vn("bech32m");const gs={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},ps=le(be(4),ue("0123456789abcdef"),fe(""),xn(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),bs={utf8:gs,hex:ps,base16:us,base32:fs,base64:hs,base64url:ds,base58:pt,base58xmr:ws};`${Object.keys(bs).join(", ")}`;var qe=new TextDecoder("utf-8");new TextEncoder;var ys=5e3;function ms(e){let{prefix:t,words:n}=Kt.decode(e,ys),r=new Uint8Array(Kt.fromWords(n));switch(t){case"nprofile":{let s=ct(r);if(!s[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:re(s[0][0]),relays:s[1]?s[1].map(o=>qe.decode(o)):[]}}}case"nevent":{let s=ct(r);if(!s[0]?.[0])throw new Error("missing TLV 0 for nevent");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(s[2]&&s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(s[3]&&s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:re(s[0][0]),relays:s[1]?s[1].map(o=>qe.decode(o)):[],author:s[2]?.[0]?re(s[2][0]):void 0,kind:s[3]?.[0]?parseInt(re(s[3][0]),16):void 0}}}case"naddr":{let s=ct(r);if(!s[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!s[2]?.[0])throw new Error("missing TLV 2 for naddr");if(s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!s[3]?.[0])throw new Error("missing TLV 3 for naddr");if(s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:qe.decode(s[0][0]),pubkey:re(s[2][0]),kind:parseInt(re(s[3][0]),16),relays:s[1]?s[1].map(o=>qe.decode(o)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:re(r)};default:throw new Error(`unknown prefix ${t}`)}}function ct(e){let t={},n=e;for(;n.length>0;){let r=n[0],s=n[1],o=n.slice(2,2+s);if(n=n.slice(2+s),o.length<s)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(o)}return t}var xs=Oe('<div class="alert alert-error"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),Es=Oe('<div class="alert alert-success"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),vs=Oe('<span class="loading loading-spinner"></span> Fetching...',1),As=Oe('<div class="divider"></div> <div class="form-control w-full"><div class="label"><span class="label-text font-semibold">CSV Output</span> <button class="btn btn-sm btn-outline"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy</button></div> <textarea class="textarea textarea-bordered font-mono text-sm h-96" readonly=""></textarea></div>',1),Bs=Oe('<div class="min-h-screen bg-base-200 p-4"><div class="container mx-auto max-w-4xl"><div class="card bg-base-100 shadow-xl"><div class="card-body"><h1 class="card-title text-3xl mb-4">Nostr Kind1 CSV Exporter</h1> <!> <!> <div class="form-control w-full"><label for="npub-input" class="label"><span class="label-text font-semibold">Public Key (npub)</span></label> <input id="npub-input" type="text" placeholder="npub1..." class="input input-bordered w-full"/></div> <div class="form-control w-full mt-4"><label for="relays-input" class="label"><span class="label-text font-semibold">Relays (one per line or comma-separated)</span></label> <textarea id="relays-input" class="textarea textarea-bordered h-24" placeholder="wss://relay.example.com"></textarea></div> <div class="card-actions justify-end mt-4"><button class="btn btn-primary"><!></button></div> <!></div></div></div></div>');function Os(e,t){$n(t,!0);let n=Se(""),r=Se("wss://yabu.me"),s=Se(""),o=Se(!1),i=Se(""),c=Se("");const a=500,l=1e4;function f(m){return m.includes('"')||m.includes(",")||m.includes(`
`)?`"${m.replace(/"/g,'""')}"`:m}function u(m){try{const A=ms(m.trim());if(A.type==="npub")return A.data;throw new Error("Invalid npub format")}catch(A){throw new Error(`Failed to decode npub: ${A instanceof Error?A.message:"Unknown error"}`)}}function w(m){return m.split(/[\n,]/).map(A=>A.trim()).filter(A=>A.length>0)}async function p(m,A,O,L=l){return new Promise(M=>{const N=[],te=m.subscribeMany(A,O,{onevent(ne){N.push(ne)},oneose(){C(),M(N)},onclose(){C(),M(N)}}),K=setTimeout(()=>{C(),M(N)},L);function C(){clearTimeout(K),te?.close()}})}async function y(){F(i,""),F(c,""),F(s,""),F(o,!0);try{const m=u(D(n)),A=w(D(r));if(A.length===0)throw new Error("At least one relay URL is required");const O=new as,L=[],M=new Set;let N;try{for(;;){const K={kinds:[1],authors:[m],limit:a};typeof N=="number"&&(K.until=N);const C=await p(O,A,K);if(C.length===0)break;let ne=C[0].created_at;for(const Q of C)Q.created_at<ne&&(ne=Q.created_at),M.has(Q.id)||(M.add(Q.id),L.push(Q));if(C.length<a||(N=ne-1,N<0))break}}finally{O.close(A)}L.sort((K,C)=>K.created_at-C.created_at);const te=["content,timestamp"];for(const K of L){const C=f(K.content),ne=new Date(K.created_at*1e3).toISOString();te.push(`${C},${ne}`)}F(s,te.join(`
`),!0),F(o,!1),L.length===0?F(c,"No kind1 events found for this user"):F(c,`Successfully fetched ${L.length} kind1 events`)}catch(m){F(o,!1),F(i,m instanceof Error?m.message:"An unknown error occurred",!0)}}async function h(){try{await navigator.clipboard.writeText(D(s)),F(c,"Copied to clipboard!"),setTimeout(()=>{D(c)==="Copied to clipboard!"&&F(c,"")},2e3)}catch{F(i,"Failed to copy to clipboard")}}var g=Bs(),b=Z(g),v=Z(b),B=Z(v),$=X(Z(B),2);{var _=m=>{var A=xs(),O=X(Z(A),2),L=Z(O,!0);G(O),G(A),Pe(()=>Lt(L,D(i))),Be(m,A)};Re($,m=>{D(i)&&m(_)})}var E=X($,2);{var S=m=>{var A=Es(),O=X(Z(A),2),L=Z(O,!0);G(O),G(A),Pe(()=>Lt(L,D(c))),Be(m,A)};Re(E,m=>{D(c)&&m(S)})}var T=X(E,2),j=X(Z(T),2);Nn(j),G(T);var U=X(T,2),k=X(Z(U),2);kt(k),G(U);var V=X(U,2),R=Z(V);R.__click=y;var se=Z(R);{var d=m=>{var A=vs();Ln(),Be(m,A)},x=m=>{var A=Un("Fetch Events");Be(m,A)};Re(se,m=>{D(o)?m(d):m(x,!1)})}G(R),G(V);var I=X(V,2);{var H=m=>{var A=As(),O=X(Hn(A),2),L=Z(O),M=X(Z(L),2);M.__click=h,G(L);var N=X(L,2);kt(N),G(O),Pe(()=>Cn(N,D(s))),Be(m,A)};Re(I,m=>{D(s)&&m(H)})}G(B),G(v),G(b),G(g),Pe(m=>R.disabled=m,[()=>D(o)||!D(n).trim()]),Ut(j,()=>D(n),m=>F(n,m)),Ut(k,()=>D(r),m=>F(r,m)),Be(e,g),kn()}On(["click"]);export{Os as component};
